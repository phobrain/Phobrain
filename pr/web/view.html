<!DOCTYPE html>
<html lang="en">
<!--
 *  SPDX-FileCopyrightText: 2015-2025 Bill Ross Photoriot <phobrain@sonic.net>
 *
 *  SPDX-License-Identifier: AGPL-3.0-or-later
-->

<head>
 <link rel="canonical" href="http://phobrain.com"/>
 <link rel="icon" href="favicon.ico"/>
 <!-- base href="http://phobrain.com" target="_top"/-->
 <meta name="Description" content="Photo association with neural nets.">
 <meta name="robots" content="noindex"/>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

 <title>Phobrain Slideshow</title>

  <script src="js/jquery/jquery-1.11.3.min.js"></script>
  <script src="js/bootstrap/bootstrap.min.js"></script>
  <script src="js/phobasic.js"></script>
  <script src="js/phodots.js"></script>

  <link rel="stylesheet" type="text/css"
         href="js/bootstrap/bootstrap.min.css" />

  <link rel="stylesheet" type="text/css"
         href="css/footer.css" />
  <link rel="stylesheet" type="text/css"
         href="css/phobasic.css" />

<style>

.caret {
  color: rgba(255,255,255,0.4);
}

.browserCaret {
  border-width: 8px ;
}
.mobileCaret {
  border-width: 18px ;
}

</style>

<script>
<!--

var lastAlert = new Date().getMilliseconds();
var alertCt = 0;

function callAlert(msg)
{
	var now = new Date().getMilliseconds();
	if (now - lastAlert > 1500) {
		alertCt = 0;
		lastAlert = now;
		alert(msg);
		return;
	}
	lastAlert = now;
	alertCt++;
	if (alertCt > 4) {
		return;
	}
	alert(msg);
}

//%%%%%%%% start photoriot

var loadCt = null;
var inPic = -1;

var loadCountCookieName = "loadCount31";

function loadCount()
{
  loadCt = getCookie(loadCountCookieName);

  if (loadCt == null  ||  loadCt.length == 0) {
      loadCt = 0;
  }
  if (loadCt == 0) {
    alert("Sketch on the photos to inspire a response.\n" +
          "Wiggly lines are like throwing a slinky toy\ninto a mountain range.\n" +
          "In landscape mode, drawing straight lines\ntries a vector projection method.\n" +
          "Stay in one photo for the fastest possible reply.\n" +
          "Cross the center 3 times or more to change the subject.\n" +
          "Click just above the photos for a random pair.\n\n" +
          "Scribble your anger and see if you see a change.\n\n" +
          "'Phob' for options, 'rain' for more info.");
  }
  loadCt++;
  setCookie(loadCountCookieName, loadCt);

  console.log("LoadCt [" + loadCountCookieName + "]: " + loadCt);
}

var ADMIN_PIX = 220; // for selector/footer plus 20px

var view = null;

function adjustViewList()
{
  document.getElementById("viewAll").className = "blackBut";
  document.getElementById("viewPeep").className = "blackBut";
  document.getElementById("viewBill").className = "blackBut";
  document.getElementById("viewRS").className = "blackBut";
  document.getElementById("viewElle").className = "blackBut";
  document.getElementById("viewEd").className = "blackBut";
  document.getElementById("viewRon").className = "blackBut";
  document.getElementById("viewEllen").className = "blackBut";

  if (view === "0") {
    document.getElementById("viewAll").className = "greyBut";
  } else if (view === "6") {
    document.getElementById("viewPeep").className = "greyBut";
  } else if (view === "1") {
    document.getElementById("viewBill").className = "greyBut";
  } else if (view === "7") {
    document.getElementById("viewRS").className = "greyBut";
  } else if (view === "2") {
    document.getElementById("viewElle").className = "greyBut";
  } else if (view === "4") {
    document.getElementById("viewEllen").className = "greyBut";
  } else if (view === "8") {
    document.getElementById("viewEd").className = "greyBut";
  } else if (view === "9") {
    document.getElementById("viewRon").className = "greyBut";
  } else {
    console.log("Unknown view: " + view);
  }
}

var screens = 2;
var sessionID = "none";

function getSessionKey()
{
  if (view == null) {
    view = getCookie("view");
    if (view == null  ||  view.length == 0) {
      view = getUrlVars()["v"];
      if (view == null  ||  view.length == 0) {
        console.log("!!! defaulting view to all");
        view = "0"; // all
        setCookie("view", "0");
      }
    }
    adjustViewList();
  }
  var k = "m";
  return "view_" + k + "_" + view;
}

var lastWipe = null;

function wipeSession()
{
	var now = new Date().getMilliseconds();
	if (lastWipe != null && now - lastWipe < 1000) {
		console.log('SKIP WIPE');
        return;
	}
	console.log('WIPE SESSION');
	var sessionKey = getSessionKey();
	setCookie(sessionKey, "");
	sessionID = "none"; // get fresh session / user is refreshing

	lastWipe = new Date().getMilliseconds();
}

var DEFAULT_TILE = 1; // 2 portraits; reset on new session based on screen dims
var tileId = DEFAULT_TILE;
var cmdMode = 1; // search options hidden

function getSessionId(load)
{
console.log("getSessionId: load: " + load);

  var sessionKey = getSessionKey();
  var k2 = getCookie(sessionKey);
  if (k2 != null  &&  k2.length > 0) {
      sessionID = k2;
  }

  var d = new Date();
  var lastDate = getCookie("lastDate");
  if (lastDate != null  &&  lastDate.length > 0) {
    var d2 = new Date(lastDate);
    if (d.getTime() - d2.getTime() < 5000) {
      sessionID = "none"; // get fresh session since user is refreshing
      setCookie(sessionKey, "");
    }
  }
  setCookie("lastDate", d.toString());


console.log("sessionID: " + sessionID);
  var oldSess = sessionID;
  if (!load  ||  sessionID === "none") {

    var ratio = window.innerWidth / window.innerHeight;
    if (ratio > 1.85) {
      console.log("wide screen");
      tileId = 2;
    } else if (ratio < 1.15) {
      console.log("tall screen");
      tileId = 3;
    } else {
      console.log("normal screen");
      tileId = 1;
    }
    setTile(tileId, 0); // 0==no reload

    console.log("get session " +
	window.innerWidth + "x" + window.innerHeight + " " + ratio +
	" tileId " + tileId);
    var xmlHttp;
    try {
      xmlHttp = getHTTP();
    } catch (e) {
      alert(e);
      return false;
    }

    // prepare for preview/showDog

    var theshow = document.getElementById("theshow");
    if (theshow.style.display != 'none') {
      theshow.style.display = 'none';
    }
    var thepreview = document.getElementById("thepreview");
    if (thepreview.style.display == 'none') {
      thepreview.style.display = '';
    }

    xmlHttp.onreadystatechange=function() {
      if(xmlHttp.readyState==4) {
        if (xmlHttp.status == 200) {
          sessionID = xmlHttp.responseText;
          //setCookie("session", sessionID);
          var k = getSessionKey();
          setCookie(k, sessionID);
          console.log("sessionID/k " + sessionID + "/" + k);
          document.getElementById("menu_tog_repeats").innerHTML = "&#x25ab;";
          repeats = false;
          showDog();
        } else if (xmlHttp.status == 401) {
          console.log("401: " + xmlHttp.responseText);
          callAlert("Unknown user");
        } else if (xmlHttp.status == 500) {
          wipeSession();
          callAlert("Server error, try reloading page or returning to main page first.");
           } else {
            console.log("Error: " + xmlHttp.status + ": " +
                xmlHttp.responseText);
            var t1 = xmlHttp.responseText.indexOf("<title>");
            if (t1 != -1) {
                t1 += 7;
                var t2 = xmlHttp.responseText.indexOf("</title>", t1);
                var tt = xmlHttp.responseText.substring(t1, t2);
                callAlert("Oops! " + tt);
            } else {
                callAlert(xmlHttp.responseText);
            }
           }

      }
    };
    var userName = "eooser";
    var k = "m";
    var params = "tzoff=" + d.getTimezoneOffset() +
		"&hour=" + d.getHours() +
		"&browser=" + navigator.appName +
		"&version=" + navigator.appVersion +
		"&platform=" + navigator.platform +
		"&lang=" + navigator.language +
		"&useragent=" + navigator.userAgent +
		"&username=" + userName +
		"&session=" + sessionID +
		"&k=" + k +
		"&v=" + view +
		"&c=" + tileId +
		"&new=x";
    try {
      var url = servletRoot + "/getsession";
      xmlHttp.open("POST", url, true);
      xmlHttp.setRequestHeader("Content-type",
                               "application/x-www-form-urlencoded");
      xmlHttp.send(params);
    } catch (e) {
      alert(e);
      return false;
    }
  } else {
    console.log("use existing session " +
	window.innerWidth + "x" + window.innerHeight);
    var t = getCookie(getTileKey());
    if (t != null  &&  t != ""  &&  tileId != t) {
      console.log("using previous tileId: [" + t + "]");
      var i = parseInt(t) || DEFAULT_TILE;
      if (t === "0") {
        setTile(0, 0);
      } else {
        setTile(i, 0);
      }
    }
    t = getCookie("goNeg");
    if (t != null  &&  t != "") {
        t = (t === 'true');
        console.log("cookie goNeg: [" + t + "] current=[" + goNeg + "]");
        if (goNeg != t) {
            console.log("using cookie goNeg: " + t + " current=" + goNeg);
            toggleNeg('reload');
        }
        if (goNeg == true) {
            alert('Reminder: "Worst pairs" option is set.');
        }
    }
	t = getCookie(getCmdModeKey());
	if (t != null  &&  t != ""  &&  cmdMode != t) {
		console.log("using previous cmdMode: " + t);
		toggleCmd(t);
	}
	toggleRepeats('status');

	if (imgNexts > 0) { // shouln't happen now that setTile reloadCode==0
	       console.log('SKIP getSess img load on imgNexts=' + imgNexts);
	} else if (screens == 1) {
        waitingDisplays = 1;
		nextImage0(0);
	} else {
		console.log('SESS: load pics tileId ' + tileId);
		if (tileId < 3) {
            waitingDisplays = 2;
			nextImage(1, 0, 'getSess 1');
			nextImage(2, 0, 'getSess 2');
		} else {
            waitingDisplays = 2;
			nextImage(3, 0, 'getSess 3');
			nextImage(4, 0, 'getSess 4');
		}
	}
  }
  return true;
}

function setView(v)
{
console.log("setView " + v + " view=" + view);
  view = "" + v;
  setCookie("view", view);
  adjustViewList();
  getSessionId(false);
}

function getTileKey()
{
  return "view_tile";
}

function getCmdModeKey()
{
  return "view_cmode";
}

function getVDepthKey() {
  return "view_vdepth";
}

function hasTouch()
{

	return ('ontouchstart' in window) ||
		(window.DocumentTouch &&
			window.document instanceof DocumentTouch) ||
		window.navigator.maxTouchPoints ||
		window.navigator.msMaxTouchPoints ? true : false;
}

var isAndroid = false;
var isIphone = false;
var isMobile = false;
var duzTuch = hasTouch();

function adjustPageElements()
{
  var ua = navigator.userAgent.toLowerCase();
  isAndroid = ua.indexOf("android") > -1;
  isIphone = ua.indexOf("iphone") > -1;

  if (!isIphone && !isAndroid) {
    console.log('Browser; touch: ' + duzTuch);
    var carets = document.getElementsByClassName("caret");
    for(var i=0, il = carets.length;i<il;i++){
        carets[i].className += " browserCaret";
    }
    return;
  }
  console.log('Mobile: ' + (isIphone ? "iPhone" : "anDroid"));

  isMobile = true;

  var carets = document.getElementsByClassName("caret");
  for(var i=0, il = carets.length;i<il;i++){
    carets[i].className += " mobileCaret";
  }

  document.getElementById("fbody").style.height = "800px";
  document.getElementById("wrapper").style.height = "800px";
  document.getElementById("home").innerHTML = "Home&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";

  var heights = [
	["phob_home", 50],
	["drop_left", 50],
	["home", 50],

	["drop_groups", 50],
	["viewAll", 50],
	["viewPeep", 50],
	["viewBill", 50],
	["viewRS", 50],
	["viewElle", 50],
	["viewEd", 50],
	["viewEllen", 50],
	["viewRon", 50],

	//["menu_square_span", 50],
	["menu_twop_span", 50],
	["menu_twol_span", 50],
	["menu_twols_span", 50],
	["menu_tog_repeats_style", 50],
	["menu_tog_neg_style", 50],
	["menu_radio_browse_mode", 50],
	["menu_radio_browse_mode_style", 50],
	["menu_radio_srch_ai_mode", 50],
	["menu_radio_srch_ai_mode_style", 50],
	["menu_radio_srch_gold_mode", 50],
	["menu_radio_srch_gold_mode_style", 50],
	["menu_radio_color_draw", 50],
	["menu_radio_watch_dots", 50],

	["rain_about", 50],
	["drop_right", 50],
	["about", 50],
	["desc_td1", 50],
	["desc_td2", 50],
	["desc_td3", 50],
	["desc_td4", 50],
	["desc_td5", 50],
	["desc_td6", 50],
	["desc_td7", 50],
	["desc_td8", 50],

	["yplus", 100],
	["minus", 100],
	["phiM0", 50],
	["phiM1", 50],
	["phiM2", 50],
	["phiM3", 50],
	["phiM4", 50],
	["phiM5", 50],
	["phiM6", 50],
	["curated", 100],
	["golden_ab", 60],
	["golden_rgb", 60],
	["golden_8", 60],
	["golden_27", 40],
	["bill_rgb_32", 40],
	["bar", 80],
	["gplus", 100],

	["toggle_both", 70],

	["foot_credit", 50]
  ];
  for (var i=0; i<heights.length; i++) {
    var x = document.getElementById(heights[i][0]);
    if (x == null) {
      callAlert("Internal error: no " + heights[i][0]);
    } else {
      var size = heights[i][1];
      if (isIphone) size = parseInt(size *= 0.6);
      x.style.fontSize = size + "px";
    }
  }

  document.getElementById("drop_groups_caret").className = "caret-right-big";

  var buttons = [
	//["menu_squareb", 50, 40],
	//["ico_square",  50, 40],
	["ico_port",  60, 40],
	["ico_land",  110, 40],
	["ico_land2",  60, 40],

	["menu_twopb",  100, 40],
	//["twop",    60, 40],

	["menu_twolb",  110, 40],
	//["twol",   110, 40],

	["menu_twolsb",  80, 40],
	//["twols",   80, 40],
  ];
  for (var i=0; i<buttons.length; i++) {
    var b = document.getElementById(buttons[i][0]);
    if (b == null) {
      callAlert("Internal error: no " + buttons[i][0]);
    } else {
      b.style.width = buttons[i][1] + "px";
      b.style.height = buttons[i][2] + "px";
    }
  }

}

function adjustCmdTds(row)
{
  console.log("adjustCmdTds: cmd/row: " + cmdMode + "/" + row);

  if (cmdMode == 1) {

    document.getElementById("yplus").style.display = 'none';
    document.getElementById("curated").style.display = 'none';
    document.getElementById("gplus").style.display = 'none';

    document.getElementById("cmdTd").style.display = 'none';
    document.getElementById("showTd").style.width = "50%";
    document.getElementById("kwdTd").style.width = "50%";

    return;
  }
  document.getElementById("cmdTd").style.display = '';
  var nitems = -1;
  if (cmdMode == 2) {
    nitems = 11;

    document.getElementById("golden_ab").style.display = 'none';
    document.getElementById("golden_rgb").style.display = 'none';
    document.getElementById("golden_8").style.display = 'none';
    document.getElementById("golden_27").style.display = 'none';
    document.getElementById("bill_rgb_32").style.display = 'none';

    if (isMobile) {
      document.getElementById("yplus").style.display = 'none';
      document.getElementById("curated").style.display = 'none';
      document.getElementById("gplus").style.display = 'none';
      document.getElementById("phiM6").style.display = 'none';
    }

    document.getElementById("phiM0").style.display = '';
    document.getElementById("phiM1").style.display = '';
    document.getElementById("phiM2").style.display = '';
    document.getElementById("phiM3").style.display = '';
    document.getElementById("phiM4").style.display = '';
    document.getElementById("phiM5").style.display = '';
    document.getElementById("phiM6").style.display = '';

  } else if (cmdMode == 3) {
    nitems = 10;

    document.getElementById("phiM0").style.display = 'none';
    document.getElementById("phiM1").style.display = 'none';
    document.getElementById("phiM2").style.display = 'none';
    document.getElementById("phiM3").style.display = 'none';
    document.getElementById("phiM4").style.display = 'none';
    document.getElementById("phiM5").style.display = 'none';
    document.getElementById("phiM6").style.display = 'none';

    document.getElementById("golden_ab").style.display = '';
    document.getElementById("golden_rgb").style.display = '';
    document.getElementById("golden_8").style.display = '';
    document.getElementById("golden_27").style.display = '';
    document.getElementById("bill_rgb_32").style.display = '';

    document.getElementById("yplus").style.display = '';
    document.getElementById("curated").style.display = '';
    document.getElementById("gplus").style.display = '';

  } else {
    alert('unknown cmdmode ' + cmdMode);
  }

  console.log('nitems: ' + nitems);

  var winWidth = window.innerWidth; // disbelief factor
  var cmdlen = 0;
  var name = navigator.browserSpecs.name;
  if (name == 'Chrome') {
    if (row == 0) cmdlen = 110;
    else cmdlen = nitems * 45;
  } else if (name == 'Firefox') {
    if (row == 0) cmdlen = 140;
    else cmdlen = nitems * 50;
  } else if (isIphone) {
    //if (row == 0) cmdlen = 110;
    //else cmdlen = nitems * 50;
    document.getElementById("cmdTd").style.width =  "";
    document.getElementById("showTd").style.width = "";
    document.getElementById("kwdTd").style.width =  "";
    return;
  } else {
    if (row == 0) cmdlen = 120;
    else cmdlen = nitems * 50;
  }
  if ((name != 'Chrome') && (isMobile)) {
    cmdlen *= 2;
  }
  var sidelen = Math.floor(0.99 * (winWidth - cmdlen) / 2);
  if (sidelen < 0 || isMobile) {
    cmdlen = winWidth;
    sidelen = 0;
  }

  console.log("adjustCmdTds: win, cmd, side " +
        winWidth + " " + cmdlen + " " + sidelen);
  document.getElementById("cmdTd").style.width = cmdlen + "px";
  document.getElementById("showTd").style.width = sidelen + "px";
  document.getElementById("kwdTd").style.width = sidelen + "px";

  document.getElementById("cmdTd").style.display = '';
}

function toggleCmd(val)
{
  console.log("toggleCmd tileId " + tileId +
	" cmdMode " + cmdMode + '-> [' + val + ']');
  if (tileId == 0) {
    return;
  }
  if (val == 1) {

	document.getElementById("menu_radio_browse_mode").innerHTML =
		"&#x25aa;";
	document.getElementById("menu_radio_srch_ai_mode").innerHTML =
		"&#x25ab;";
	document.getElementById("menu_radio_srch_gold_mode").innerHTML =
		"&#x25ab;";

  } else if (val == 2) {

	document.getElementById("menu_radio_browse_mode").innerHTML =
		"&#x25ab;";
	document.getElementById("menu_radio_srch_ai_mode").innerHTML =
		"&#x25aa;";
	document.getElementById("menu_radio_srch_gold_mode").innerHTML =
		"&#x25ab;";

  } else if (val == 3) {

	document.getElementById("menu_radio_browse_mode").innerHTML =
		"&#x25ab;";
	document.getElementById("menu_radio_srch_ai_mode").innerHTML =
		"&#x25ab;";
	document.getElementById("menu_radio_srch_gold_mode").innerHTML =
		"&#x25aa;";

  } else {
	alert('unknown radio but: ' + val);
  }
  cmdMode = val;
  setCookie(getCmdModeKey(), cmdMode);
  adjustCmdTds(tileId);
}

var watchDots = false;
var waitingDotty = 0;

function toggleWatchDots()
{
    watchDots = !watchDots;
    waitingDotty = 0;

    if (watchDots) {
		document.getElementById("menu_radio_watch_dots").innerHTML =
			"Dots: don't wait";
    } else {
		document.getElementById("menu_radio_watch_dots").innerHTML =
			"Dots: 2nd click";
    }
}


var colorDraw = true;

function toggleColorDraw()
{
	colorDraw = !colorDraw;
	if (colorDraw) {
		document.getElementById("menu_radio_color_draw").innerHTML =
			"Draw: use grey";
	} else {
		document.getElementById("menu_radio_color_draw").innerHTML =
			"Draw: use colors";
	}
}

var md = null;

function getMD(e)
{

console.log("getMD retry " + retry0Ct);

  //e.preventDefault();

  var xmlHttp;
  try {
     xmlHttp = getHTTP();
  } catch (e) {
     alert(e);
     return false;
  }
  xmlHttp.onreadystatechange=function() {
    if(xmlHttp.readyState==4) {
      if (xmlHttp.status == 200) {
         md = JSON.parse(xmlHttp.responseText);
         console.log("md.credit rcvd: " + md.credit);
         console.log("md.kw rcvd: " + md.kw);
         showMD();
      } else if (xmlHttp.status == 401) {
        console.log("401: " + xmlHttp.responseText);
        callAlert("Unknown user");
      } else if (xmlHttp.status == 500) {
        wipeSession();
        callAlert("Server error, try reloading page.");
      }
    }
  };
  try {
    var params = "sess=" + sessionID;
    switch (tileId) {
      case 0:
        params += "&p1=x&p2=x\n"; break;
      case 1:
      case 2:
        params += "&p1=1." + vDepth[1] +
                  "&p2=2." + vDepth[2] + "\n";
        break;
      case 3:
        params += "&p1=1." + vDepth[3] +
                  "&p2=2." + vDepth[4] + "\n";
        break;
      default:
        alert("unexp tileId: " + tileId);
        break;
    }

console.log("md params for getkext: " + params);
    var url = servletRoot + "/getkext";
    xmlHttp.open("POST", url, true);
    xmlHttp.setRequestHeader("Content-type",
                               "application/x-www-form-urlencoded");
    xmlHttp.send(params);
  } catch (e) {
    alert(e);
    return false;
  }
  return true;
}
var repeats = false;

function toggleRepeats(val)
{
  console.log("toggleRepeats " + val + " repeats: " + repeats);

  var xmlHttp;
  try {
     xmlHttp = getHTTP();
  } catch (e) {
     alert(e);
     return false;
  }
  xmlHttp.onreadystatechange=function() {
    if(xmlHttp.readyState==4) {
      if (xmlHttp.status == 200) {
        var t = xmlHttp.responseText.trim();
        console.log("RESP: [" + t + "]");
        if ("OK" === t) {
          if (repeats) {
            document.getElementById("menu_tog_repeats").innerHTML = "&#x25ab;";
          } else {
            document.getElementById("menu_tog_repeats").innerHTML = "&#x25aa";
          }
          repeats = !repeats;
        } else if ("true" === t) {
          document.getElementById("menu_tog_repeats").innerHTML = "&#x25aa";
          repeats = true;
        } else if ("false" === t) {
          document.getElementById("menu_tog_repeats").innerHTML = "&#x25ab;";
          repeats = false;
        } else {
          console.log("Unexpected rpts: " + xmlHttp.responseText);
        }
        // md = JSON.parse(xmlHttp.responseText);
        // console.log("md " + md);
      } else if (xmlHttp.status == 401) {
        console.log("401: " + xmlHttp.responseText);
        callAlert("Unknown user");
      } else if (xmlHttp.status == 500) {
        wipeSession();
        callAlert("Server error, try reloading page.");
      }
    }
  };
  try {
    var params = "sess=" + sessionID;
    if ("status" === val) {
      params += "&pr=status";
    } else {
      params += "&pr=" + !repeats;
    }

console.log("tog repeats params: " + params);
    var url = servletRoot + "/getkext";
    xmlHttp.open("POST", url, true);
    xmlHttp.setRequestHeader("Content-type",
                               "application/x-www-form-urlencoded");
    xmlHttp.send(params);
  } catch (e) {
    alert(e);
    return false;
  }
  return true;
}

var goNeg = false;

function toggleNeg(msg)
{
  console.log("toggleNeg [" + msg + "] on: " + goNeg);

  if (goNeg) {
    document.getElementById("menu_tog_neg").innerHTML = "&#x25ab;";
	"<span style='color:black;'>&#x25ab</span>";
    //document.getElementById("menu_tog_neg_style").innerHTML = "'Bad' prs";
  } else {
    document.getElementById("menu_tog_neg").innerHTML =
	"<span style='color:red;'>&#x25aa</span>";
//alert('col ' +  document.getElementById("menu_tog_neg").style.color);
    //document.getElementById("menu_tog_neg_style").innerHTML = "Train prs";
  }
  goNeg = !goNeg;
  setCookie("goNeg", goNeg);
console.log("Cookie: " + getCookie("goNeg") + " ..set=" + goNeg);
}


function setTile(row, reloadCode)
{
console.log("setTile " + row + " reloadCode " + reloadCode);

  switch (row) {
    case 0:
	// document.getElementById("menu_squareb").className = 'greyBut';
	document.getElementById("menu_twopb").className = 'blackBut';
	document.getElementById("menu_twolb").className = 'blackBut';
	document.getElementById("menu_twolsb").className = 'blackBut';
	//document.getElementById("menu_cmd_mode").className = 'greyBut';
	break;
    case 1:
	//document.getElementById("menu_squareb").className = 'blackBut';
	document.getElementById("menu_twopb").className = 'greyBut';
	document.getElementById("menu_twolb").className = 'blackBut';
	document.getElementById("menu_twolsb").className = 'blackBut';
	//document.getElementById("menu_cmd_mode").className = 'blackBut';
	break;
    case 2:
	// document.getElementById("menu_squareb").className = 'blackBut';
	document.getElementById("menu_twopb").className = 'blackBut';
	document.getElementById("menu_twolb").className = 'greyBut';
	document.getElementById("menu_twolsb").className = 'blackBut';
	//document.getElementById("menu_cmd_mode").className = 'blackBut';
	break;
    case 3:
	// document.getElementById("menu_squareb").className = 'blackBut';
	document.getElementById("menu_twopb").className = 'blackBut';
	document.getElementById("menu_twolb").className = 'blackBut';
	document.getElementById("menu_twolsb").className = 'greyBut';
	//document.getElementById("menu_cmd_mode").className = 'blackBut';
	break;
  }
/*
  if (row == tileId) {
    return;
  }
*/
  setCookie(getTileKey(), row); // redundant when called from fresh session load

  md = null;
  mdK = null;

  for (var i=0; i<imgRcvd.length; i++) {
    vDepth[i] = 0;
    imgRcvd[i] = null;
    imgRcvdPrev[i] = null;
  }

  if (isMobile) {
    switch (row) {
      case 0:
      case 1:
        document.getElementById("fbody").style.height =    "800px";
        document.getElementById("wrapper").style.height = "800px";
        break;
      case 2:
        document.getElementById("fbody").style.height =    "600px";
        document.getElementById("wrapper").style.height = "600px";
        break;
      case 3:
        document.getElementById("fbody").style.height =    "1400px";
        document.getElementById("wrapper").style.height = "1400px";
        break;
      default: break;
    }
  }
  if (row == 0) {
    cmdMode = 2;
  }
  if (row == 0  ||  tileId == 0) {
    adjustCmdTds(row);
  }

  // only with tr1+
  var curated = document.getElementById("curated");
  var yplus = document.getElementById("yplus");
  var golden_ab = document.getElementById("golden_ab");
  var golden_rgb = document.getElementById("golden_rgb");
  var golden_8 = document.getElementById("golden_8");
  var golden_27 = document.getElementById("golden_27");
  var bill_rgb_32 = document.getElementById("bill_rgb_32");

  if (row == 0) {
    tileId = 0;

    screens = 1;

    document.getElementById("spacer").style.height = "10px";

    curated.style.display = 'none';
    yplus.style.display = 'none';

    golden_ab.style.display = 'none';
    golden_rgb.style.display = 'none';
    golden_8.style.display = 'none';
    golden_27.style.display = 'none';
    bill_rgb_32.style.display = 'none';

    adjustCmdTds(row);
    waitingDisplays = 1;
    nextImage0(0);

  } else if (tileId != row) {
    var oldTileId = tileId;
    tileId = row;

    screens = 2;

    adjustCmdTds(row);
/*
    curated.style.display = '';
    yplus.style.display = '';
    golden_ab.style.display = '';
    golden_rgb.style.display = '';
    golden_8.style.display = '';
    golden_27.style.display = '';
    bill_rgb_32.style.display = '';
*/

    if (reloadCode==1 ||
        (oldTileId == 2  &&  tileId == 3) ||
        (oldTileId == 3  &&  tileId == 2)) {
      bigone(1, 1, -3, 'setTile/-3');
    } else if (reloadCode==2) {
      bigone(1, 1, -2, 'setTile/-2');
    }
  }
}


var mouseDown = 0;

// phodots imageIn = -1;
// phodots inImage = 0;
// phodots dotSpeed = 0;

var myScroll;

$(document).ready(function() {
  //resizeImg();
  //$(window).resize(resizeImg);

  //myScroll = new IScroll('#wrapper'); // prevent horiz scroll
/*
  if (isAndroid || isIphone || duzTuch) {
alert('touchy!');
    $("#image0").on("touchenter", function() { inImage++; });
    $("#image0").on("touchleave", function() { inImage--; });
    $("#image1").on("touchenter", function() { alert('te1');inImage++; });
    $("#image1").on("touchleave", function() { inImage--; });
    $("#image2").on("touchenter", function() { inImage++; });
    $("#image2").on("touchleave", function() { inImage--; });
    $("#image3").on("touchenter", function() { inImage++; });
    $("#image3").on("touchleave", function() { inImage--; });
    $("#image4").on("touchenter", function() { inImage++; });
    $("#image4").on("touchleave", function() { inImage--; });
  } else {
*/
    $("#image0").on("mouseenter", function() { inImage++; imageIn = 0; });
    $("#image0").on("mouseleave", function() { inImage--; imageIn = -1; });
    $("#image1").on("mouseenter", function() { inImage++; imageIn = 1; });
    $("#image1").on("mouseleave", function() { inImage--; imageIn = -1; });
    $("#image2").on("mouseenter", function() { inImage++; imageIn = 2; });
    $("#image2").on("mouseleave", function() { inImage--; imageIn = -1; });
    $("#image3").on("mouseenter", function() { inImage++; imageIn = 3; });
    $("#image3").on("mouseleave", function() { inImage--; imageIn = -1; });
    $("#image4").on("mouseenter", function() { inImage++; imageIn = 4; });
    $("#image4").on("mouseleave", function() { inImage--; imageIn = -1; });
	       // override chrome user agent stylesheet body.margin=8
	       document.getElementById("fbody").style.margin = 0;
	       //document.getElementById("fbody").style.display = 'block';
//  }

//$( "#invisButton" ).dblclick(function() {
//  alert( "Handler for .dblclick() called." );
//});
});

var servletRoot = "/pr";  // set in proj/web/build.gradle


function drawTwo()
{
console.log("drawTwo");

  reDot();

  if (isAndroid || isIphone) {

    var height = 0.6 * window.innerWidth;
    if (tileId == 2) height *= 0.6;
    //else if (tileId == 3) height *= 0.8;
    height = parseInt(height);

    var start = 1;
    if (tileId > 2) start = 3;

    for (var i=start; i<start+2; i++) {
      console.log("vdepth " + i + " " + vDepth[i]);
      var img2draw;
      if (vDepth[i] == 0) {
          img2draw = imgRcvd[i];
      } else {
          img2draw = imgRcvdPrev[i];
      }
      if (img2draw == null) {
        console.log("null 2draw");
      } else {
        var img = document.getElementById("image" + i);
        if (img == null) callAlert("NO image " + i);
        setImg(img2draw, img, height);
        drawTouch(img, i);
        //img.src = img2draw.src;
      }
    }
  } else {
    // resizeImage() inline for newimg use TODO consolidate
    var tot_height = window.innerHeight;

    var avail_height = tot_height - ADMIN_PIX;
    if (tileId != 2) {
      avail_height += 60;
    }
    var remaining_width = 0;

    if (tileId == 2) {
      if (useLastTileId2Height) {
        avail_height = lastTileId2Height;
        useLastTileId2Height = false;
      } else {
        var imgRcvd1, imgRcvd2;
        if (vDepth[1] == 0) {
          imgRcvd1 = imgRcvd[1];
        } else {
          imgRcvd1 = imgRcvdPrev[1];
        }
        if (vDepth[2] == 0) {
          imgRcvd2 = imgRcvd[2];
        } else {
          imgRcvd2 = imgRcvdPrev[2];
        }
        if (imgRcvd1 == null  ||  imgRcvd2 == null) {
          console.log("default scaling");
          avail_height /= 1.45;
          avail_height = Math.floor(avail_height);
        } else {
/*
          var max_ht = imgRcvd1.height;
          if (imgRcvd2.height > max_ht) {
            max_ht = imgRcvd2.height;
          }
*/
          var tot_width = imgRcvd1.width * avail_height / imgRcvd1.height;
          tot_width += imgRcvd2.width * avail_height / imgRcvd2.height;;
          var avail_width = window.innerWidth;
          avail_width -= 80; // clickable margins
          remaining_width = 80;
console.log("widths " + imgRcvd1.width + " " + imgRcvd2.width +
" = " + tot_width + " W " + avail_width + " " + window.innerWidth +
" tot_height " + window.innerHeight +
" avail_height " + avail_height);
          if (tot_width > avail_width) {
            var ws = avail_width / tot_width;
            avail_height *= ws;
            avail_height = Math.floor(avail_height);
console.log("avail_height " + avail_height);
          }
        }
/*
        if (avail_height < minHeightTile2) {
          minHeightTile2 = avail_height;
        } else {
          avail_height = minHeightTile2;
        }
*/
        lastTileId2Height = avail_height;
      }
    } else if (tileId == 3) {
      avail_height /= 2;
    }

    switch (tileId) {
      case 1:
      case 2:
        document.getElementById("td1").setAttribute("height", avail_height);
        document.getElementById("td2").setAttribute("height", avail_height);
        if (remaining_width > 0) {
          var t = remaining_width / 2;
          document.getElementById("tr1_td_start").setAttribute("width", t);
          document.getElementById("tr1_td_end").setAttribute("width", t);
        }
        break;
      case 3:
        document.getElementById("td3").setAttribute("height", avail_height);
        document.getElementById("td4").setAttribute("height", avail_height);
        break;
    }

    var ii = 1;
    if (tileId == 3) ii = 3;
    for (var i=ii; i<ii+2; i++) {
      var imgsrc;
      if (vDepth[i] == 0) {
          imgsrc = imgRcvd[i];
      } else {
          imgsrc = imgRcvdPrev[i];
      }
      if (imgsrc == null) {
        console.log("src null " + i);
      } else {

        var img = document.getElementById("image" + i);

        setImg(imgsrc, img, avail_height);
        drawTouch(img, i);
        if (tileId == 3) {
console.log("SET td" + i + " to match img width " + img.width);
          document.getElementById("td" + i).setAttribute("width", img.width);
        }
      }
    }

  }
  // final reveal
  document.getElementById("tr0").style.display = 'none';
  if (tileId == 1) {
    document.getElementById("tr1").style.display = '';
    document.getElementById("tr2").style.display = 'none';
    document.getElementById("spacer").style.height = "10px";
  } else if (tileId == 2) {
    document.getElementById("tr1").style.display = '';
    document.getElementById("tr2").style.display = 'none';
    document.getElementById("spacer").style.height = "40px";
  } else if (tileId == 3) {
    document.getElementById("tr1").style.display = 'none';
    document.getElementById("tr2").style.display = '';
    document.getElementById("spacer").style.height = "10px";
  }
  showView();
  prevTime = new Date();

/*
  // see if backlog
  if (dotList.length == 0) {
      return;
  }

  // is user drawing now?
  var lastDot = dotList[dotList.length-1];
  if (!lastDot.mouseUp) {
      return;
  }

  launchOrWaitDotty('chain');
*/
}

var waitingDisplays = 0;

function decrementDisplayCountdown()
{
console.log("decrementDisplayCountdown " + waitingDisplays +
" tileId " + tileId);

  if (waitingDisplays == 0) {
    callAlert("Error, decrementing 0");
    return;
  }
  // not thread safe
  waitingDisplays--;
  if (waitingDisplays > 0) {
    return;
  }

  drawTwo();
}

var imgNexts = 0;
function nextImage(screen, rating, caller) // screen in 1,2 or 3,4
{
  imgNexts += 1;
  console.log('NEXTIMAGE_' + imgNexts +
			': caller ' + caller +
			' screen ' + screen +
			' waitingDisplays: ' + waitingDisplays);

//alert('nextImage ' + caller);
  md = null;
  mdK = null;

  startNext = new Date();

  var vecX = 0;
  var vecY = 0;
  if (accumCount > 0) {
    // console.log("acc " + accumX + "/" + accumY + " " + accumCount + "\n" +
                   // lastClickX + "/" + lastClickY);
    vecX = (accumX / accumCount) - mousedownX;
    vecY = (accumY / accumCount) - mousedownY;
  }

  //console.log("rating " + rating);
  var interval = 0;
  if (prevTime) {
    interval = new Date() - prevTime;
  }

  var newimg = new Image();
  newimg.onerror=function(evt) {
    console.log("newimg.onerror: ", evt);
    callAlert("Image load problem: (Safari+MacOS<11: use Chrome) try refreshing page or choosing another view");
    decrementDisplayCountdown();
  }
  newimg.onload=function() {
    if (newimg.height == 1  &&  newimg.width == 1) {
      console.log('empty image');
      decrementDisplayCountdown();

      // empty.jpg
      var conf = confirm(
                "DONE with view. You can start over, " +
                "switch orientation to " +
                        ( tileId == 1 ? "horizontal" : "vertical" ) + ", " +
                (repeats == false ? "enable pic repeats, " : "") +
                "or view another photographer. Start over?");
      if (conf) {
        getSessionId(false);
      }
      return;
    }
console.log("loaded " + screen + " " + newimg.width + "x" + newimg.height);

    // when image is loaded, make it visible
    var now = new Date();
    imageLoaded = now - startNext;

    imgRcvdPrev[screen] = imgRcvd[screen];
    imgRcvd[screen] = newimg;
    vDepth[screen] = 0;
    decrementDisplayCountdown();
    dotSpeed++;
    startDotGibber(false);
  }


  dTot = Math.round(dTot);

  var lox = [ "na", "na" ];
  if (rating == 4  ||  rating == 5) {
    var img = document.getElementById("image" + screen);
    lox = getLox(img);
  }
  var url = servletRoot + "/getmext";
  // TODO - add lots and binhex it
  var togSide = togL + togR;
  if (togSide === '') {
    togSide = 'na';
  }
  // map to 1,2
  var ss = screen;
  if (tileId > 2) {
    ss = screen - 2;
  }
if (ss > 2 || ss < 1) alert ("ss " + ss + " tileId " + tileId);

  var o = "o";
  if (tileId == 1) o = "v";
  else if (tileId > 1) o = "h";

  var dots = summarizeDots(false);
  var params = "?sess=" + sessionID +
		"&sc1=" + ss +
		"&sc2=" + ss +
		"&d=" + vDepth[screen] +
        "&c=l" +
        "&o=" + o +
		"&r=" + rating +
		"&w=0&mt=0" +
		"&ct=" + picCount++ +
		"&pp=" + pixInPic +
		"&po=" + pixOutPic +
		"&t=" + interval +
		"&t2=" + timeMaxVel +
		"&d=" + dTot +
		"&d2=" + Math.round(distMaxVel) +
		"&mxv=" + maxVel +
		"&mxa=" + maxAcc +
		"&mna=" + minAcc +
		"&mxj=" + maxJerk +
		"&dx=" + (maxX - minX) +
		"&dy=" + (maxY - minY) +
		"&vcx=" + Math.round(vecX) +
		"&vcy=" + Math.round(vecY) +
		"&loc=" + lox[0] +
		"&locspec=" + lox[1] +
		"&btm=" + bigTime +
		"&ltm=" + imageLoaded +
		"&ntog=" + nToggleLast +
		"&tgs=" + togSide +
		"&togt=" + base64Str(togTimes).trim() +
		dots;
  params = limitURIDots(params);
  // start load of image into memory
console.log("GO " + url + "\n" + params);
  newimg.src = url + params;

  // while waiting, have a good time

  nToggleLast = 0;
  togTimes = [];
  lastTogTime = null;
  togL = "";
  togR = "";
  togSide = null;

  resetDrawCounts();
}


function showDog() {
  var newimg = new Image();
  newimg.onload=function() {
    // when image is loaded, make it visible
    var img = document.getElementById("imageP");
    img.src = newimg.src;
    img.width = window.innerWidth;
    img.setAttribute("height", "auto");
    img.setAttribute("vertical-align", "top");
    img.setAttribute("float", "right");
    fade(img);
  };
  // start load of image into memory
  newimg.src = "dog_eyes2.jpg";
}

function fade(element) {
  console.log("fade tileId " + tileId);
  var op = 1;  // initial opacity
  var timer = setInterval(function () {
      if (op <= 0.1) {
         clearInterval(timer);
         if (tileId == 0) {
           waitingDisplays = 1;
           nextImage0(0);
         } else if (tileId < 3) {
           waitingDisplays = 2;
           nextImage(1, 0, 'fade 1');
           nextImage(2, 0, 'fade 2');
         } else {
           waitingDisplays = 2;
           nextImage(3, 0, 'fade 3');
           nextImage(4, 0, 'fade 4');
         }
      }
      element.style.opacity = op;
      element.style.filter = 'alpha(opacity=' + op * 100 + ")";
      op -= op * 0.3;
    }, 100);
}

function showView() {
  document.getElementById("thepreview").style.display = 'none';
  document.getElementById("theshow").style.display = '';
}

var vDepth = [0, 0, 0, 0, 0];
var imgRcvd = [null, null, null, null, null];
var imgRcvdPrev = [null, null, null, null, null];

var nToggleLast = 0;
var togL = '';
var togR = '';
var togTimes = [];
var lastTogTime = null;

function toggleLast(screen, side) {

  if ($('#drop1').isActive()  ||  $('#drop2').isActive()) {
    console.log("toggleLast: dropdown is active/skip");
    return;
  }

  console.log("toggleLast " + screen + " " + side);

  if (side === 'l') {
    togL = 'l';
  } else if (side === 'r') {
    togR = 'r';
  } else {
    togL = 'l';
    togR = 'r';
  }

  md = null;
  mdK = null;

  var t0 = lastTogTime;
  if (t0 == null) {
    t0 = prevTime;
  }
  lastTogTime = new Date();
  togTimes.push(lastTogTime - t0);
  if (screen == -1) {
    var ii = 0; // 1-1
    if (tileId == 3) ii = 2; // 3-1
    for (var i=0; i<2; i++) {
      ii++;
      if ((vDepth[ii] == 0  &&  imgRcvdPrev[ii] == null)  ||
          (vDepth[ii] == 1  &&  imgRcvd[ii] == null)) {
        alert("No pictures to go back to " + ii);
        return;
      }
      nToggleLast++;
      if (vDepth[ii] == 0) {
        vDepth[ii] = 1;
      } else {
        vDepth[ii] = 0;
      }

    }
    drawTwo();
    return;
  } else {

    if ((vDepth[screen] == 0  &&  imgRcvdPrev[screen] == null)  ||
        (vDepth[screen] == 1  &&  imgRcvd[screen] == null)) {
      alert("No picture to go back to " + screen);
      return;
    }
    if (vDepth[screen] == 0) {
      vDepth[screen] = 1;
    } else {
      vDepth[screen] = 0;
    }

    nToggleLast++;

    if (screen == 0) {
      drawOne();
    } else {
      drawTwo();
    }
  }
}

var mdown_time = null;

function mdown() {
//alert('mdown');
  mdown_time = new Date();
}

var bothToggleDown = null;

function bothToggle() {
  if (tileId == 0) {
    toggleLast(0, 'm');
    return;
  }

  if (bothToggleDown == null) {
    return;
  }

  var dt = new Date() - bothToggleDown;
  if (dt < 1000) {
    toggleLast(-1, 'm');
  } else { // go back to last new

    for ( var i=1; i<vDepth.length; i++) {
      vDepth[i] = 0;
    }
    drawTwo();
  }

  bothToggleDown = null;
}


var mouseDownNextToPlus = false;
var mouseDownOnCredit = false;

var mdK = null;
var retry0Ct = 0;

function showMD() {

  if (!mouseDownNextToPlus  &&  !mouseDownOnCredit) return;

  if (tileId == 0) {
    if (md == null) {
console.log("md is null retry " + retry0Ct);
      retry0Ct++;
      if (retry0Ct > 2) {
        retry0Ct = 0;
        return;
      }
      getMD();
      return;
    }
    retry0Ct = 0;

  } else {

    var ii = 1;
    if (tileId == 3) ii = 3;

    var ps = "0." + vDepth[ii] + "1." + vDepth[ii+1];
    if (md == null  ||  ps != mdK) {
      mdK = ps;
      getMD();
      return;
    }
  }
  var content;
  if (mouseDownOnCredit) {
    content = md.credit;
  } else {
    content = md.kw;
  }
  //console.log("content [" + content.trim() + "]");
  var fsize = 15;
  if (duzTuch) fsize = 40;
  var td = document.getElementById("kwdTd");
  td.innerHTML = "<span style=\"text-align:right;" +
		" color:rgba(255,255,255,0.4);" +
		"font-size: " + fsize + "pt;" +
		" font-family:'Courier New',Courier,monospace;\">" +
			content.trim() +
		"</span>";
}

function hideKwds() {
  mouseDownNextToPlus = false;
  var td = document.getElementById("kwdTd");
  td.innerHTML = "&nbsp;";
}

function hideCredit() {
  mouseDownOnCredit = false;
  var td = document.getElementById("kwdTd");
  td.innerHTML = "&nbsp;";
}

function logApproval(status)
{
  var xmlHttp;
  try {
     xmlHttp = getHTTP();
  } catch (e) {
     alert(e);
     return false;
  }
  xmlHttp.onreadystatechange=function() {
    if(xmlHttp.readyState==4) {
      if (xmlHttp.status == 200) {
         console.log("approval " + xmlHttp.responseText);
      } else if (xmlHttp.status == 401) {
        console.log("401: " + xmlHttp.responseText);
        callAlert("Unknown user");
      } else if (xmlHttp.status == 500) {
        wipeSession();
        callAlert("Server error, try reloading page.");
      }
    }
  };
  try {
    var v1Depth, v2Depth;
    if (tileId < 3) {
      v1Depth = vDepth[1];
      v2Depth = vDepth[2];
    } else {
      v1Depth = vDepth[3];
      v2Depth = vDepth[4];
    }
    var params = "sess=" + sessionID +
		"&p1=1." + v1Depth +
        "&p2=2." + v2Depth +
        "&st=" + status + "\n";

console.log(params);
    var url = servletRoot + "/errorme";
    xmlHttp.onreadystatechange=function() {
      if(xmlHttp.readyState==4) {
        if (xmlHttp.status != 200) {
          callAlert("failed: " + xmlHttp.status + " " + xmlHttp.responseText);
        }
      }
    };
    xmlHttp.open("POST", url, true);
    xmlHttp.setRequestHeader("Content-type",
                               "application/x-www-form-urlencoded");
    xmlHttp.send(params);
  } catch (e) {
    alert(e);
    return false;
  }
  return true;
}


function resizeImg0() {

console.log("resizeImg0");

  var tot_height = window.innerHeight;
  var avail_height = tot_height - ADMIN_PIX; // for selector/footer plus 10px

  var td = document.getElementById("td0");
  td.setAttribute("height", avail_height);

  var img = document.getElementById("image0");

  if (isAndroid || isIphone) {
    img.style.opacity = "1.0";
    return;
  }

  if (img.height > avail_height) {

    console.log("resize height " + img.height + " to " + avail_height +
                " tot_height " + window.innerHeight);

    var scaled_width = (avail_height / img.height) * img.width;

    var canvas = document.createElement( 'canvas' );
    canvas.width = scaled_width;
    canvas.height = avail_height;
    var tmp = new Image();
    tmp.src = img.src;
    context = canvas.getContext( '2d' );
    context.drawImage( tmp, 0, 0, scaled_width, avail_height);
    img.src = canvas.toDataURL( 'image/jpeg', 0.92 );
    drawTouch(img, 0);

  }
  img.onmousedown = disableDragging; // for FF
  img.style.opacity = "1.0";
}



function nextImage0(rating)
{

console.log("nextImage0: " + rating);
alert("nextImage0 NEEDS REHAB");
if (true) return;

  md = null;
  mdK = null;

  startNext = new Date();

  var vecX = 0;
  var vecY = 0;
  if (accumCount > 0) {
    // console.log("acc " + accumX + "/" + accumY + " " + accumCount + "\n" +
                   // lastClickX + "/" + lastClickY);
    vecX = (accumX / accumCount) - mouseDownX;
    vecY = (accumY / accumCount) - mouseDownY;
  }

  //console.log("rating " + rating);
  var interval = 0;
  if (prevTime) {
    interval = new Date() - prevTime;
  }

  var newimg = new Image();
  newimg.onerror=function(evt) {
    callAlert("Image load problem: try refreshing page");
  }
  newimg.onload=function() {
    if (newimg.height == 1  &&  newimg.width == 1) {

      // empty.jpg
      var conf = confirm("DONE with view. You can start over or go back and enter another view. Start over?");
      if (conf) {
        getSessionId(false);
      }
      return;
    }
console.log("loaded");

    imgRcvdPrev[0] = imgRcvd[0];
    imgRcvd[0] = newimg;
    vDepth[0] = 0;
    drawOne();
  }

  dTot = Math.round(dTot);

  var lox = [ "na", "na" ];

  if (rating == 4  ||  rating == 5) {

    var img = document.getElementById("image0");
    lox = getLox(img);

    console.log("top " + crds.top + " bottom " + bottom +
                "\nleft " + crds.left + " right " + right +
                "\nX " + mousedownX + " Y " + mousedownY +
                "\nloc " + lox[0] +
                "\nlocspec " + lox[1]);

  }
  var url = servletRoot +"/getnext";
  // TODO - add lots and binhex it
  var togSide = togL + togR;
  if (togSide === '') {
    togSide = 'na';
  }
  var dots = summarizeDots(true);
  var params = "?sess=" + sessionID +
		"&ct=" + picCount +
		"&r=" + rating +
		"&pp=" + pixInPic +
		"&po=" + pixOutPic +
		"&t=" + interval +
		"&t2=" + timeMaxVel +
		"&w=0&mt=0" +
		"&d=" + dTot +
		"&d2=" + Math.round(distMaxVel) +
		"&mxv=" + maxVel +
		"&mxa=" + maxAcc +
		"&mna=" + minAcc +
		"&mxj=" + maxJerk +
		"&dx=" + (maxX - minX) +
		"&dy=" + (maxY - minY) +
		"&vcx=" + Math.round(vecX) +
		"&vcy=" + Math.round(vecY) +
		"&loc=" + lox[0] +
		"&locspec=" + lox[1] +
		"&ltm=" + imageLoaded +
		"&ntog=" + nToggleLast +
		"&tgs=" + togSide +
		"&togt=" + base64Str(togTimes).trim() +
		dots;
  params = limitURIDots(params);
  // start load of image into memory
  newimg.src = url + params;
  drawTouch(newimg, 0);

  // while waiting, have a good time

  nToggleLast = 0;
  togTimes = [];
  lastTogTime = null;
  togL = "";
  togR = "";
  togSide = null;

  pixInPic = 0;
  pixOutPic = 0;
  dTot = 0;
  maxVel = 0;
  lastVel = 0;
  distMaxVel = 0;
  timeMaxVel = 0;
  maxAcc = 0;
  minAcc = 0;
  lastAcc = 0;
  maxJerk = 0;
  lastClickX = lastX;
  lastClickY = lastY;
  maxX = lastX;
  minX = lastX;
  maxY = lastY;
  minY = lastY;
  accumX = lastX;
  accumY = lastY;
  accumCount = 1;
}

var ctxt = null;

function setImg(imgsrc, img, avail_height)
{
  if (img == null) {
    callAlert("NO image");
    return;
  }
  if (imgsrc.height == avail_height) {
    console.log("no resize");
    var canvas = document.createElement( 'canvas' );
    canvas.width = imgsrc.width;
    canvas.height = avail_height;
    var context = canvas.getContext( '2d' );
    context.drawImage( imgsrc, 0, 0, imgsrc.width, imgsrc.height);
    img.src = canvas.toDataURL( 'image/jpeg', 0.92 );;
    return;
  }

  console.log("resize height " + imgsrc.height +
            " to " + avail_height +
            " tot_height " + window.innerHeight);

  var scaled_width = (avail_height / imgsrc.height) * imgsrc.width;

  var canvas = document.createElement( 'canvas' );
  canvas.width = scaled_width;
  canvas.height = avail_height;
  var context = canvas.getContext( '2d' );
  context.drawImage( imgsrc, 0, 0, scaled_width, avail_height);
  context.lineWidth = 150;
  ctxt = context;
  var tmp = canvas.toDataURL( 'image/jpeg', 0.92 );
  img.src = tmp;
  img.onmousedown = disableDragging; // for FF
  img.style.opacity = "1.0";
  console.log("resized");
}

function drawOne()
{

  // when image is loaded, make it visible
  var now = new Date();
  imageLoaded = now - startNext;

  var img = document.getElementById("image0");

  var newimg;
  if (vDepth[0] == 0) {
    newimg = imgRcvd[0];
  } else {
    newimg = imgRcvdPrev[0];
  }

  showView();

  if (isAndroid || isIphone) {
    img.src = newimg.src;
    drawTouch(img, 0);
    //var canvas = document.createElement( 'canvas' );
    //canvas.width = newimg.width;
    //canvas.height = newimg.height;
    //context = canvas.getContext( '2d' );
    //context.drawImage( newimg, 0, 0, newimg.width, newimg.height);
    //img.src = canvas.toDataURL( 'image/jpeg', 0.92 );
  } else {
console.log("maybe resize");
    // resizeImage() inline for newimg use TODO consolidate
    var tot_height = window.innerHeight;
    var avail_height = tot_height - ADMIN_PIX; // for selector/footer plus 10px
    avail_height += 60; // inverse logic
    var td = document.getElementById("td0");
    td.setAttribute("height", avail_height);

    if (newimg.height <= avail_height) {
console.log("use as-is");
      img.src = newimg.src;
      drawTouch(img, 0);
    } else {

      console.log("inline resize height " + newimg.height + " to " +
		avail_height + " tot_height " + window.innerHeight);

      var scaled_width = (avail_height / newimg.height) * newimg.width;

      var canvas = document.createElement( 'canvas' );
      canvas.width = scaled_width;
      canvas.height = avail_height;
      context = canvas.getContext( '2d' );
      context.drawImage( newimg, 0, 0, scaled_width, avail_height);
context.lineWidth = 15;
      img.src = canvas.toDataURL( 'image/jpeg', 0.92 );
      drawTouch(img, 0);
    }
  }
  img.onmousedown = disableDragging; // for FF
  img.style.opacity = "1.0";

  document.getElementById("tr0").style.display = '';
  document.getElementById("tr1").style.display = 'none';
  document.getElementById("tr2").style.display = 'none';

  prevTime = new Date();
  picCount++;
}


var minHeightTile2 = 99999999;

var useLastTileId2Height = false;
var lastTileId2Height = null;



var bigStartPost = null;
var bigTime = -1;

var enterBig = null;

function bigone(scrn1, scrn2, rating, caller)  // scrn's in 0=ignore, 1,2
{
    var watched = 0;
    if (watchDots  &&  watchStart != null) {
        watched = new Date() - watchStart;
    }
    watchStart = null;

  var signatoor = '============ BIGONE caller ' + caller +
	    ' waitingDisplays: ' + waitingDisplays +
	    ' scrn1/2 ' + scrn1 + '/' + scrn2 +
	    ' rating ' + rating + '  enter: ' +
	    (enterBig == null ? 'fresh' : (new Date()-enterBig)) +
	    '  watched: ' + watched;

if (scrn1 == 0  ||  scrn2 == 0)
alert('bigone scrn(s) 0 ' + signatoor);

  if (waitingDisplays != 0) {
    console.log(signatoor +
            ' -=-=> sweet Callipsioids! tromping');
    return;
  }
console.log('WOW ' + signatoor);

  if (enterBig == null) {
    enterBig = new Date();
  } else {
    var age = new Date() - enterBig;
    if (age < 1500) {
      console.log(signatoor +
          ' -=-=> sweet Mehosaphat! too fast, skipping away');
      return;
    }
  }
  console.log(signatoor);
  waitingDisplays = 2;

  if (scrn1 == 3) scrn1 = 1;
  else if (scrn1 == 4) scrn1 = 2;

  if (scrn2 == 3) scrn2 = 1;
  else if (scrn2 == 4) scrn2 = 2;

//Keep dots & pics: see cacheDots too
//alert('keeping dots hack in bigone');
//return;

  var vecX = 0;
  var vecY = 0;
  if (accumCount > 0) {
    // console.log("acc " + accumX + "/" + accumY + " " + accumCount + "\n" +
                   // lastClickX + "/" + lastClickY);
    vecX = (accumX / accumCount) - mousedownX;
    vecY = (accumY / accumCount) - mousedownY;
  }

  //console.log("rating " + rating);
  var interval = 0;
  if (prevTime) {
    interval = new Date() - prevTime;
  }

  dTot = Math.round(dTot);

  var lox = [ "na", "na" ]

  if (rating == 4  ||  rating == 5) {
    var img = document.getElementById("image" + scrn);
    lox = getLox(img);
  }

  var xmlHttp;
  try {
    xmlHttp = getHTTP();
  } catch (e) {
    alert(e);
    return false;
  }
  xmlHttp.onreadystatechange=function() {
    //var t0 = new Date();
    if(xmlHttp.readyState==4) {
      console.log("bigone http " + xmlHttp.status);
      if (xmlHttp.status == 200) {
        console.log('BIG200: ' + xmlHttp.responseText);
        bigTime = new Date();
        bigTime -= bigStartPost;
        if (xmlHttp.responseText.startsWith("rgb,")) {
          var respTxt = xmlHttp.responseText.trim();
          var arr = respTxt.split(',');

          var raw = arr[1].split(':');
          rgbs['1.0'] = rgbs['1.1'];
          for(var i=0; i<raw.length; i++) { raw[i] = parseInt(raw[i], 10); }
          var rgbRadius = raw[3];
          raw[3] = rgbRadius / 255; // make frac
          rgbs['1.1'] = raw;

          raw = arr[2].split(':');
          rgbs['2.0'] = rgbs['2.1'];
          for(var i=0; i<raw.length; i++) { raw[i] = parseInt(raw[i], 10); }
          rgbRadius = raw[3];
          raw[3] = rgbRadius / 255; // make frac
          rgbs['2.1'] = raw;
 //QQQ
          dotSpeed++;
          startDotGibber(false);

          if (tileId < 3) {
            waitingDisplays = 2;
            nextImage(1, 0, 'bigone 1 / ' + caller);
            nextImage(2, 0, 'bigone 2 / ' + caller);
          } else {
            waitingDisplays = 2;
            nextImage(3, 0, 'bigone 3 / ' + caller);
            nextImage(4, 0, 'bigone 4 / ' + caller);
          }
        } else if (xmlHttp.responseText == "DONE\n") {
            console.log("DONE");
            var conf = confirm(
		"DONE with view. You can start over, " +
		"switch orientation to " +
			( tileId == 1 ? "horizontal" : "vertical" ) + ", " +
		(repeats == false ? "enable pic repeats, " : "") +
		"or view another photographer. Start over?");
            if (conf) {
              getSessionId(false);
            }
            enterBig = null;
            return;
        } else if (xmlHttp.responseText == "ODONE\n") {
            console.log("ODONE");
            alert("Photos all seen for this orientation. Please try either"
                + (tileId == 1 ? " a horizontal " : " vertical ") + " orientation, or another Photographer/Subject.");
            enterBig = null;
            return;
        } else {
            callAlert('Unexpected BIG200: ' + xmlHttp.responseText);
        }
      } else if (xmlHttp.status == 204) {
alert('big 204/legacy');
      } else if (xmlHttp.status == 401) {
        console.log("401: " + xmlHttp.responseText);
        callAlert("Unknown user");
      } else if (xmlHttp.status == 500) {
        wipeSession();
        callAlert("Server error, try reloading page.");

      } else if (xmlHttp.status == 0) {
	    callAlert('Unexpected Server response (0) - ' +
		    'you may be disconnected from the net.');
        waitingDisplays = 0;
      } else {
	    callAlert('Unexpected Server response: ' + xmlHttp.status);
      }
      enterBig = null;
    }
  };

  // TODO - add lots and binhex it
  var togSide = togL + togR;
  if (togSide === '') {
    togSide = 'na';
  }
  var orient = "o";
  if (tileId == 1) {
    orient = "v"
  } else if (tileId == 2 || tileId == 3) {
    orient = "h";
  }
  var dots = summarizeDots(true);
  var params = "sess=" + sessionID +
		"&sc1=" + scrn1 +
		"&sc2=" + scrn2 +
        "&c=m" +
        "&o="  + orient +
		"&r=" + rating +
		"&ct=" + picCount +
		"&pp=" + pixInPic +
		"&po=" + pixOutPic +
		"&t=" + interval +
		"&t2=" + timeMaxVel +
		"&w=" + watched +
        "&mt=0" +
		"&d=" + dTot +
		"&d2=" + Math.round(distMaxVel) +
		"&mxv=" + maxVel +
		"&mxa=" + maxAcc +
		"&mna=" + minAcc +
		"&mxj=" + maxJerk +
		"&dx=" + (maxX - minX) +
		"&dy=" + (maxY - minY) +
		"&vcx=" + Math.round(vecX) +
		"&vcy=" + Math.round(vecY) +
		"&loc=" + lox[0] +
		"&locspec=" + lox[1] +
		"&btm=" + bigTime +
		"&ltm=" + imageLoaded +
		"&ntog=" + nToggleLast +
		"&tgs=" + togSide +
		"&togt=" + base64Str(togTimes).trim() +
		dots;
  params = limitURIDots(params);
//console.log('params\n' + params);
  try {
    var url = servletRoot + "/getmext";
    bigStartPost = new Date();
    xmlHttp.open("POST", url, true);
    xmlHttp.setRequestHeader("Content-type",
                               "application/x-www-form-urlencoded");
    xmlHttp.send(params);
    startDotGibber(false);
  } catch (e) {
    alert(e);
    enterBig = null;
    return false;
  }

  // while waiting, have a good time

  nToggleLast = 0;
  togTimes = [];
  lastTogTime = null;
  togL = "";
  togR = "";
  togSide = null;

  resetDrawCounts();
}


function imgClick(nimg, ev)
{
console.log('imgClick ' + nimg + ' cmdMode ' + cmdMode + ' ' + ev);
	if (cmdMode == 1) {
		return;
	}
	if (nimg == 0) {
		alert('imgClick(0) not supported');
	}
    setLastXY(ev);

	if (cmdMode == 2) {
            waitingDisplays = 1;
        	nextImage(nimg, 4, 'imgClick ' + nimg);
	} else {
            waitingDisplays = 1;
        	nextImage(nimg, 5, 'imgClick ' + nimg);
	}
}

function iClick(scrn1, scrn2, caller)
{
console.log('iClick ' + scrn1 + ' ' + scrn2 + ' cmdMode ' + cmdMode + ' caller ' + caller);
if (scrn1 == 0  ||  scrn2 == 0) alert('iClick scrns ' + scrn1 + '/' + scrn2 + ' caller ' + caller);

	if (cmdMode < 1  ||  cmdMode > 3) {
		alert('iClick: Unexpected cmdMode: ' + cmdMode);
		return;
	}
	if (dotList.length == 0) {
		console.log('Browse mode and no dots: denied');
		return;
	}
//if (isMobile) alert('iClick ' + scrn1 + ' ' + scrn2 + ' cmdMode ' + cmdMode);
	if ((cmdMode == 2  ||  cmdMode == 3)  &&  scrn1 == scrn2) {
		// same as imgClick() /click on pic
		if (cmdMode == 2) {
            waitingDisplays = 1;
            nextImage(scrn1, 4, 'iClick ' + scrn1);
		} else {
            waitingDisplays = 1;
        	nextImage(scrn1, 5, 'iClick ' + scrn1);
		}
		return;
	}

	var cmd = (goNeg ? 13 : 10);
	var cmt = (goNeg ? 'iClick/neg' : 'iClick');
//alert('ICLICLLLLKLKLK ' + cmd);
	bigone(scrn1, scrn2, cmd, cmt);
}

function yplus()
{
  switch (tileId) {
    case 0:
      alert("yplus not impl");
      return;
    case 1:
    case 2:
    case 3:
      // 2023_07 - adjusting 0,0 to 1,1
      var scrn1 = vDepth[1];
      var scrn2 = vDepth[2];
      if (scrn1 == 0  &&  scrn2 == 0) {
        scrn1 = 1;
        scrn2 = 1;
      }
      bigone(scrn1, scrn2, 1, 'yplus');
      break;

    default:
      alert("yplus not impl " + tileId);
  }
}

function minus()
{
  switch (tileId) {
    case 0:
      waitingDisplays = 1;
      nextImage0(1);
      break;
    case 1:
    case 2:
    case 3:
      bigone(1, 1, 0, 'minus');
      break;
    default:
      alert("minus not impl " + tileId);
  }
}

function phi(val)
{
  bigone(1, 1, val, 'phi');
}

function curated()
{
  switch (tileId) {
    case 0:
      alert("curated not impl");
      return;
    case 1:
    case 2:
    case 3:
      bigone(1, 1, 10, 'curated');
      break;
    default:
      alert("curated not impl " + tileId);
  }
}

function golden(option)
{
  switch (tileId) {
    case 0:
      alert("golden not impl");
      return;
    case 1:
    case 2:
    case 3:
      bigone(vDepth[1], vDepth[2], option, 'golden');
      break;
    default:
      alert("golden not impl " + tileId);
  }
}

function ranD()
{
  switch (tileId) {
    case 0:
      waitingDisplays = 1;
      nextImage0(2);
      break;
    case 1:
    case 2:
    case 3:
      bigone(1, 1, 2, 'rand');
      break;
    default:
      alert("ranD not iml");
  }
}

function gplus()
{
  switch (tileId) {
    case 0:
      waitingDisplays = 1;
      nextImage0(3);
      break;
    case 1:
    case 2:
    case 3:
      bigone(1, 1, 3, 'gplus');
      break;
    default:
      alert("gplus not impl, tileid " + tileId);
  }
}


function launchOrWaitDotty(src)
{
  var side1 = dotSide(dotList[0]);
  var i = dotList.length-1;
  while (i > 0  &&  dotList[i].mouseUp) i--;
  var lastDot = dotList[i]; // made an effort
  var side2 = dotSide(lastDot);

  var cmd = (goNeg ? 13 :10);
  var cmt = src + (goNeg ? '/neg' : '');

  if (watchDots) {
    if (waitingDotty > 0) {

      waitingDotty = 0;

      bigone(side1, side2, cmd, cmt);

    } else {
      waitingDotty++;
    }
  } else {
    bigone(side1, side2, cmd, cmt);
  }
}

var TIMEOUT = 100 * 1000;

document.addEventListener('DOMContentLoaded', function () {
    // ...
  document.body.onmousedown = function() {
console.log('DOWN ' + mouseDown);
    mouseDown = 1;
    //++mouseDown;
  }
  //document.body.ontouchstart = document.body.onmousedown;

  document.body.onmouseup = function() {
    console.log('MOUSEUP/body  down=' + mouseDown +
            ' waitingDisplays=' + waitingDisplays +
            ' dotList=' + dotList.length);

    mouseDown = 0;
    //if (mouseDown > 0) { --mouseDown; }

    if (dotList.length == 0) {
      return;
    }

    //placeDot => -1's == mouseup
	placeDot(imageIn, -1, -1, lastX, lastY, new Date(), false);

    if (waitingDisplays != 0) {
      if (enterBig != null  &&  new Date() - enterBig > TIMEOUT) {
        console.log('TIMEOUT ' + TIMEOUT +
            ' resetting waitingDisplays ' + waitingDisplays);
        waitingDisplays = 0; // allows bigone() to go
      }
    }
    launchOrWaitDotty('mouseup');
  }
  //document.body.ontouchend = document.body.onmouseup;
});


// -->
</script>
</head>

<!-- NEUTRAL GREY BACKGROUND -->
<body id="fbody">

<noscript>
 <!--style type="text/css">
  .wrapper {display:none;}
 </style -->
 <div class="h4">
You don't have javascript enabled.  This page will not work.<br/><br/>
Lost in the venal void our dreams deflate<br/>
By easy stages through green atmosphere,<br/>
Imagination's bright balloon is late, like the blue whale,<br/>
In coming up for air.<br/><br/>
-- Mervyn Peake
 </div>
</noscript>

<div id="wrapper">

<!-- DRAW PAGE -->

<div id="header">

<table style="width:100%">
<tr>
<td style="text-align:left">
<div id="drop1" class="dropdown">
 <button id="phob_home" class="basicButton dropdown-toggle" type="button"
 data-toggle="dropdown">
Phob <span class="caret"></span> </button>
 <ul id="drop_left" class="dropdown-menu multi-level" role="menu"
        aria-labelledby="phob_home">
  <li> <a id="home" class="blackBut" style="padding:5px;"
        href="index.html">Home</a></li>

  <li class="divider" style="background-color: rgba(255,255,255,0.4);"></li>

  <li class="dropdown-submenu">
        <button id="drop_groups" tabindex="-1" class="blackBut"
		style="font-size:14pt;"
		type="button" data-toggle="dropdown">Photogs/Subjects
		<span id="drop_groups_caret" class="caret-right"></span>
	</button>

        <ul class="dropdown-menu">
	<li> <button id="viewAll" class="blackBut" style="font-size:14pt;"
		onclick="setView(0);">
		All&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(43,500 pics)
	</button></li>
	<li> <button id="viewPeep" class="blackBut" style="font-size:14pt;"
		onclick="setView(6);">
		Selected (600+ pics)
	</button></li>
	<li> <button id="viewBill" class="blackBut" style="font-size:14pt;"
		onclick="setView(1);">
                Bill&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(37,600 pics)
	</button></li>
	<li> <button id="viewRS" class="blackBut" style="font-size:14pt;"
		onclick="setView(7);">
                Raf&amp;Skot (3,300 pics)
	</button></li>
	<li> <button id="viewElle" class="blackBut" style="font-size:14pt;"
		onclick="setView(2);">
                Elle&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1,300 pics)
	</button></li>
	<li> <button id="viewEd" class="blackBut" style="font-size:14pt;"
		onclick="setView(8);">
                Ed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(900 pics)
	</button></li>
	<li> <button id="viewRon" class="blackBut" style="font-size:14pt;"
		onclick="setView(9);">
                Ron&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(325 pics)
	</button></li>
	<li> <button id="viewEllen" class="blackBut" style="font-size:14pt;"
		onclick="setView(4);">
                Ellen&nbsp;&nbsp;&nbsp;&nbsp;(230 pics)
	</button></li>
        </ul>
        </li>
  <li class="divider" style="background-color: rgba(255,255,255,0.4);"></li>
  <!-- li> <button id="menu_squareb" onclick="setTile(0);" class="blackBut">
	<span id="menu_square_span" style="font-size:14pt;white-space:nowrap;">
         Single Photo&nbsp;
	 <img id="ico_square" src="ico/square_any3_ico.jpg" alt="square icon">
        </span>
       </button></li -->
  <li> <button id="menu_twopb"  class="greyBut" style="font-size:14pt;"
	onclick="setTile(1, 2);">
	<span id="menu_twop_span" style="font-size:14pt;white-space:nowrap;">
         2xPortrait &nbsp;&nbsp;
	 <img id="ico_port" src="ico/portraits3_ico.jpg"
		alt="icon of two portrait images">
        </span>
       </button></li>
  <li> <button id="menu_twolb" class="blackBut"
	onclick="setTile(2, 2);">
	<span id="menu_twol_span" style="font-size:14pt;white-space:nowrap;">
	2xLandscape &nbsp;
	 <img id="ico_land" src="ico/landscapes3_ico.jpg"
		alt="icon of two landscape images">
        </span>
       </button></li>
  <li> <button id="menu_twolsb" class="blackBut"
	onclick="setTile(3, 2);">
	<span id="menu_twols_span" style="font-size:14pt;white-space:nowrap;">
         2xLandscape &nbsp;
	 <img id="ico_land2" src="ico/landscapes_stacked4_ico.jpg"
		alt="icon of two landscape images stacked">
        </span>
       </button></li>


  <li class="divider" style="background-color: rgba(255,255,255,0.4);"></li>

  <li> <button id="browse_mode"  class="blackBut"
	onclick="toggleCmd(1);">
	<span id="menu_radio_browse_mode_style"
		style="font-size:14pt;white-space:nowrap;">
	  <span id="menu_radio_browse_mode"
		style="color:#404040;">&#x25aa;</span>
	  Browse Mode
	</span></button></li>
  <li> <button id="ai_mode" onclick="toggleCmd(2);" class="blackBut">
	<span id="menu_radio_srch_ai_mode_style"
		style="font-size:14pt;white-space:nowrap;">
	  <span id="menu_radio_srch_ai_mode"
		style="color:#404040;">&#x25ab;</span>
	  Search Mode: AI
	</span></button></li>
  <li> <button id="angle_mode" class="blackBut"
	onclick="toggleCmd(3);">
	<span id="menu_radio_srch_gold_mode_style"
		style="font-size:14pt;white-space:nowrap;">
	  <span id="menu_radio_srch_gold_mode"
		style="color:#404040;">&#x25ab;</span>
	  Search: Golden Angle
	</span></button></li>

  <li class="divider" style="background-color: rgba(255,255,255,0.4);"></li>

  <li> <button id="neg_but" class="blackBut"
	onclick="toggleNeg('menu')">
	<span id="menu_tog_neg_style"
		style="font-size:14pt;white-space:nowrap;">
	<span id="menu_tog_neg" style="color:#404040;">&#x25ab;</span>
	Worst pairs (slow)
	</span></button></li> <!-- &#x25aa black -->

  <li> <button id="repeat_but" class="blackBut"
	onclick="toggleRepeats('value')" >
	<span id="menu_tog_repeats_style"
		style="font-size:14pt;white-space:nowrap;">
	<span id="menu_tog_repeats" style="color:#404040;">&#x25ab;</span>
	Let pics repeat
	</span></button></li> <!-- &#x25aa black -->

  <li class="divider" style="background-color: rgba(255,255,255,0.4);"></li>

  <li> <button id="watch_dots" class="blackBut"
	onclick="toggleWatchDots();">
	<span id="menu_radio_watch_dots"
			style="font-size:14pt;white-space:nowrap;">
		Dots: 2nd click</span>
	</button></li>

  <li> <button id="color_draw" class="blackBut"
	onclick="toggleColorDraw();">
	<span id="menu_radio_color_draw"
			style="font-size:14pt;white-space:nowrap;">
		Draw: use grey</span>
	</button></li>

 </ul>
</div>
</td>
<td>
</td>
<td style="text-align:right">
<button title="RESET SESSION" onclick="wipeSession(); getSessionId(false);" onmousedown="mdown();" class="invisBut">RESET</button>
</td>

<td style="text-align:right">
<div id="drop2" class="dropdown">
<button id="rain_about" class="basicButton dropdown-toggle" type="button"
 data-toggle="dropdown">
<span class="caret"></span> rain</button>
 <ul id="drop_right" class="dropdown-menu">
  <li> <a id="about" class="blackBut" style="padding:5px;" href="explain.html">
	<span style="color: darkblue;">About&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></a></li>
  <li>
<table><tbody><tr>
 <td id="desc_td1" style="vertical-align: text-top;padding:5px;text-align:left;white-space:nowrap; color:black;font-size: 10pt; font-family:'Courier New',Courier,monospace">
  Browse mode:
 </td>
 <td id="desc_td2" style="padding:5px;text-align:left; color:black;font-size: 10pt; font-family:'Courier New',Courier,monospace">
	Draw on the photos to see another pair.
	<br />
	See 'Phob' options:
	<br />
	&nbsp; &nbsp; &nbsp; Worst pairs
	<br />
	&nbsp; &nbsp; &nbsp; Draw: use colors
	<br />
	For pure random choice, click in the grey strip just above the pairs.
 </td>
</tr> <tr>
 <td id="desc_td3" style="vertical-align: text-top;padding:5px;text-align:left;white-space:nowrap;color:black;font-size: 10pt; font-family:'Courier New',Courier,monospace">
  Heartbeat:
 </td>
 <td id="desc_td4" style="padding:5px;text-align:left; color:black;font-size: 10pt; font-family:'Courier New',Courier,monospace">
	Your click timing
	is used in the choices, to set up a self-hypnotic feedback loop.
	Wave the mouse or draw on the photos for more effect:
	every effort is made to see movement like an animal.
 </td>
</tr> <tr>
 <td id="desc_td5" style="vertical-align: text-top;padding:5px;text-align:left;white-space:nowrap;color:black;font-size: 10pt; font-family:'Courier New',Courier,monospace">
  Universe:
 </td>
 <td id="desc_td6"
	style="padding:5px;text-align:left; color:black;font-size: 10pt; font-family:'Courier New',Courier,monospace">
	To let the universe speak directly in pure random choice,
	in Browse Mode click in the grey strip just above the pairs.
 </td>
</tr> <tr>
 <td id="desc_td7" style="vertical-align: text-top;padding:5px;text-align:left;white-space:nowrap;color:black;font-size: 10pt; font-family:'Courier New',Courier,monospace">
  Search modes:
 </td>
 <td id="desc_td8" style="padding:5px;text-align:left; color:black;font-size: 10pt; font-family:'Courier New',Courier,monospace">
        Use +-c|+ and mode-specific options to associate the next pair,
        hover on options for descriptions.
        Click on center or corners of a photo to use different algorithms
        to replace it with a match to its neighbor.

 </td>
</tr></tbody></table>
        </li>
 </ul>
</div>
</td>
</tr>
</table>
</div>

<div id="content">
<div id="thepreview">
  <img id="imageP" src="noimage" alt="preview?">
</div>

<div id="theshow"
 style="width:100%;display:none;text-align:center; margin-left:auto; margin-right:auto;">
<center>
<table><tbody>
 <tr>
  <td id="spacer" colspan="4">
    <button title="RANDOM UNSEEN"
	onclick="ranD();this.blur();"
      class="invisBut2"><i>Random</i></button> </td>
 </tr>

 <tr id="tr0" style="display:none;">
  <td style="width:30%;" onclick="toggleLast(0, 'l');"> </td>
  <td id="td0">
    <img id="image0" title="draw on pic to see next pic"
     onmousedown="mdown();"
     onmouseup="waitingDisplays=1;nextImage0(4);"
     onmouseenter="inPic=0;"
     onmouseleave="inPic=-1;"
     draggable="false"
     src="noimage" alt="photo?">
  </td>
  <td style="width:30%;" onclick="toggleLast(0, 'r');"> </td>
  <td style="width:0%;"> </td>
 </tr>

 <tr id="tr1">
  <td id="tr1_td_start" style="width:40px;" onclick="toggleLast(1, 'l');"> </td>
  <td id="td1" style="padding:2px;">
    <img id="image1"
     onmousedown="mdown();"
     onmouseup="imgClick(1, event);"
     onmouseenter="inPic=1;"
     onmouseleave="inPic=-1;"
     draggable="false" src="noimage" alt="photo?">
  </td>
  <td id="td2" style="padding:2px;">
    <img id="image2"
     onmousedown="mdown();"
     onmouseup="imgClick(2, event);"
     onmouseenter="inPic=2;"
     onmouseleave="inPic=-1;"
     draggable="false" src="noimage" alt="photo?">
  </td>
  <td id="tr1_td_end" style="width:40px;" onclick="toggleLast(2, 'r');"> </td>
 </tr>

 <tr id="tr2" style="display:none;">
  <td style="width:100%;">
   <table style="width:100%;"><tbody>
    <tr><td><table style="width:100%;"><tbody><tr>
     <td style="width:100px;" onclick="toggleLast(3, 'l');"> </td>
     <td id="td3" style="text-align:center;padding:2px;" >
      <img id="image3"
	onmousedown="mdown();"
	onmouseup="imgClick(3, event);"
	onmouseenter="inPic=3;"
	onmouseleave="inPic=-1;"
	draggable="false" src="noimage" alt="photo?">
     </td>
     <td style="width:100px;" onclick="toggleLast(3, 'r');"> </td>
    </tr></tbody></table></td></tr>
    <tr><td><table style="width:100%;"><tbody><tr>
     <td style="width:100px;" onclick="toggleLast(4, 'l');"> </td>
     <td id="td4" style="text-align:center;padding:2px;" >
      <img id="image4"
	onmousedown="mdown();"
	onmouseup="imgClick(4, event);"
	onmouseenter="inPic=4;"
	onmouseleave="inPic=-1;"
	draggable="false" src="noimage" alt="photo?">
     </td>
     <td style="width:100px;" onclick="toggleLast(4, 'r');"> </td>
    </tr></tbody></table></td></tr>
   </tbody></table>
  </td>
  <td style="width:0%;"> </td>
  <td style="width:0%;"> </td>
  <td style="width:0%;"> </td>
 </tr>
</tbody></table>
</center>
</div>
<div id="footer">

<button style="width:100%;background:transparent;border:none;"
	id="toggle_both"
	title="toggle both"
	onclick="this.blur();"
	onmousedown="bothToggleDown=new Date();"
	onmouseup="bothToggle();">
 &nbsp;
</button> <br />

<table id="cmds" style="width:100%; text-align:center;"><tbody>
<tr>
 <td id="showTd"
   title="show info"
   onmousedown="mouseDownNextToPlus=true; showMD(event);"
   onmouseup="hideKwds();"
   onmouseleave="hideKwds();"> &nbsp;</td>
 <td id="cmdTd" style="display: none; width:130px; text-align:center;">
  <button id="yplus" title="color match"
   style="font-size:50px; color:yellow;"
   onmousedown="mdown();"
   onmouseup="yplus();">
+
  </button>
  <button id="minus" title="neural net distant" style="font-size:50px; color:red;"
   onmousedown="mdown();"
   onmouseup="minus();">
-
  </button>

  <button id="curated" title="curated pair"
   style="font-size:50px; color:rgba(255,255,255,0.3);"
   onmousedown="mdown();"
   onmouseup="curated();">
c
  </button>


  <button id="phiM1" title="Neural nets: pos group 1: all pos-only"
        style="font-size:20px; color:#553355;"
        onmousedown="mdown();"
        onmouseup="phi(21);">
&Sigma;1
  </button>

  <button id="phiM2" title="Neural nets: pos group 2"
        style="font-size:20px; color:#553355;"
        onmousedown="mdown();"
        onmouseup="phi(22);">
&Sigma;2
  </button>

  <button id="phiM3" title="Neural nets: pos group 3"
        style="font-size:20px; color:#553355;"
        onmousedown="mdown();"
        onmouseup="phi(23);">
&Sigma;3
  </button>

  <button id="phiM4" title="Neural nets: pos group 4"
        style="font-size:20px; color:#553355;"
        onmousedown="mdown();"
        onmouseup="phi(24);">
&Sigma;4
  </button>

  <button id="phiM5" title="Neural nets: pos group 5"
        style="font-size:20px; color:#553355;"
        onmousedown="mdown();"
        onmouseup="phi(25);">
&Sigma;5
  </button>

  <button id="phiM0" title="Neural nets: average of all predictions"
        style="font-size:20px; color:#553355;"
        onmousedown="mdown();"
        onmouseup="phi(20);">
&Sigma;0
  </button>

  <button id="phiM6" title="Neural nets: random group"
        style="font-size:20px; color:#553355;"
        onmousedown="mdown();"
        onmouseup="phi(26);">
<span style="font-family:'Times New Roman', Times, serif">
&Sigma;&xscr;
</span>
  </button>


  <button id="golden_ab" title="golden angle AB"
   style="font-size:30px; color:rgba(255,255,255,0.3);"
   onmousedown="mdown();"
   onmouseup="golden(6);">
2
  </button>

  <button id="golden_rgb" title="golden angle RGB"
   style="font-size:30px; color:rgba(255,255,255,0.3);"
   onmousedown="mdown();"
   onmouseup="golden(7);">
3
  </button>

  <button id="golden_8" title="golden angle RGB 2x2x2"
   style="font-size:30px; color:rgba(255,255,255,0.3);"
   onmousedown="mdown();"
   onmouseup="golden(9);">
8
  </button>

  <button id="golden_27" title="golden angle RGB 3x3x3"
   style="font-size:20px; color:rgba(255,255,255,0.3);"
   onmousedown="mdown();"
   onmouseup="golden(8);">
27
  </button>

  <button id="bill_rgb_32" title="Bill's angle RGB 32x32x32"
   style="font-size:15px; color:rgba(255,255,255,0.3);"
   onmousedown="mdown();"
   onmouseup="golden(11);">
32K
  </button>


  <button id="bar" title="random" style="font-size:40px; color:blue;"
   onmousedown="mdown();"
   onmouseup="ranD();">
|
  </button>

  <button id="gplus" title="keyword match" style="font-size:50px; color:green;"
   onmousedown="mdown();"
   onmouseup="gplus();">
+
  </button>
 </td>
 <td style="text-align:left;"
   title="show info"
   onmousedown="mouseDownNextToPlus=true; showMD(event);"
   onmouseup="hideKwds();"
   onmouseleave="hideKwds();">
	<span id="kwdTd" style="vertical-align:40%;font-size:50px;"> &nbsp;</span></td>
</tr>
</tbody></table>
<br>
<p id="foot_credit"
	class="unselectable"
	onmousedown="mouseDownOnCredit=true; showMD(event);"
	onmouseup="hideCredit();"
	onmouseleave="hideCredit();"
   title="show photo credit"
   style="color:rgba(255,255,255,0.4);font-size: 14pt; font-family:'Courier New',Courier,monospace; text-align:right;">
  &copy; 2015-2025 Photoriot.</p>
<!-- INITIALIZE -->

<script>
<!--
try {
  if (window.location.search) {
    window.location.href = window.location.origin + window.location.pathname;
  }
  loadCount();
  adjustPageElements();
  adjustCmdTds(1);
  getSessionId(true);
} catch (e) {
  alert(e);
}
// -->
</script>
</div>
</div>
</div>
</body>
</html>
